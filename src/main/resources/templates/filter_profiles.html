<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Filtered Profiles</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 20px;
            padding: 0;
        }

        h1 {
            margin-bottom: 20px;
        }

        form {
            margin-bottom: 20px;
        }

        label {
            display: inline-block;
            width: 150px;
            margin-bottom: 10px;
        }

        input[type="number"],
        input[type="text"],
        select {
            width: 250px;
            padding: 8px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-bottom: 10px;
        }

        button[type="submit"] {
            padding: 10px 20px;
            font-size: 16px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        button[type="submit"]:hover {
            background-color: #0056b3;
        }

        ul {
            list-style-type: none;
            padding: 0;
        }

        li {
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        li strong {
            display: inline-block;
            width: 200px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Filtered Profiles</h1>

    <form th:action="@{/profiles}" th:object="${filter}" method="post">
        <label for="averageRating">Average Rating:</label>
        <input type="number" id="averageRating" th:field="*{averageRating}" step="0.1"><br><br>

        <label for="fullName">Full Name:</label>
        <input type="text" id="fullName" th:field="*{fullName}"><br><br>

        <label for="username">Username:</label>
        <input type="text" id="username" th:field="*{username}"><br><br>

        <label for="location">Location:</label>
        <select id="location" th:field="*{location}" onchange="saveSelectedLocation()">
            <option value="">Select location...</option>
        </select><br><br>

        <label for="priceAPost">Price A Post:</label>
        <input type="number" id="priceAPost" th:field="*{priceAPost}"><br><br>

        <label for="priceAToHireADay">Price To Hire A Day:</label>
        <input type="number" id="priceAToHireADay" th:field="*{priceAToHireADay}"><br><br>

        <label for="priceAVideo">Price A Video:</label>
        <input type="number" id="priceAVideo" th:field="*{priceAVideo}"><br><br>

        <label for="representativePrice">Representative Price:</label>
        <input type="number" id="representativePrice" th:field="*{representativePrice}"><br><br>

        <label for="categoryName">Category Name:</label>
        <select id="categoryName" th:field="*{categoryName}">
            <option value="">Select category...</option>
            <option th:each="category : ${categories}" th:value="${category.categoryName}" th:text="${category.categoryName}"></option>
        </select><br><br>

        <button type="submit">Filter</button>
    </form>

    <h2>Filtered Results:</h2>
    <ul>
        <li th:each="profile : ${profiles}">
            <strong>Full Name:</strong> <span th:text="${profile.fullName}"></span><br>
            <strong>Username:</strong> <span th:text="${profile.user.username}"></span><br>
            <strong>Rating:</strong> <span th:text="${profile.averageRating}"></span><br>
            <strong>Location:</strong> <span th:text="${profile.location}"></span><br>
            <strong>Price A Post:</strong> <span th:text="${profile.priceAPost}"></span><br>
            <strong>Price To Hire A Day:</strong> <span th:text="${profile.priceAToHireADay}"></span><br>
            <strong>Price A Video:</strong> <span th:text="${profile.priceAVideo}"></span><br>
            <strong>Representative Price:</strong> <span th:text="${profile.representativePrice}"></span><br>
            <strong>Categories:</strong>
            <ul>
                <li th:each="categoryName : ${profile.categoryNames}">
                    <span th:text="${categoryName}"></span>
                </li>
            </ul>
        </li>
    </ul>

    <!-- JavaScript to populate the dropdowns with categories and locations -->
    <script th:inline="javascript">
        const categories = /*[[ ${categories} ]]*/ []; // Lấy danh sách categories từ model

        // Function to fetch locations from backend API
        async function fetchLocations() {
            try {
                const response = await fetch('https://esgoo.net/api-tinhthanh/1/0.htm');
                const data = await response.json();
                return data.data; // Trả về dữ liệu từ API
            } catch (error) {
                console.error('Error fetching locations:', error);
                return [];
            }
        }

        // Function to populate locations dropdown
        async function populateLocationsDropdown() {
            const locations = await fetchLocations();
            const locationDropdown = document.getElementById('location');

            locations.forEach(location => {
                const option = document.createElement('option');
                option.value = location.name;
                option.textContent = location.name;
                locationDropdown.appendChild(option);
            });

            // Restore selected location from local storage
            const selectedLocation = localStorage.getItem('selectedLocation');
            if (selectedLocation) {
                locationDropdown.value = selectedLocation;
            }
        }

        // Save selected location to local storage
        function saveSelectedLocation() {
            const selectedLocation = document.getElementById('location').value;
            localStorage.setItem('selectedLocation', selectedLocation);
        }

        document.addEventListener('DOMContentLoaded', function() {
            populateLocationsDropdown();
        });
    </script>
</body>
</html>
